---
title: "openarchaeoCollaboration"
description: |
  Insert abstract here.
author:
  - name: Zack Batist
    url: https://zackbatist.github.io
    affiliation: University of Toronto
  - name: Joe Roe
    url: https://joeroe.io
    affiliation: University of Copenhagen
date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r dependencies, include=FALSE}
library("tidyverse")
library("openarchaeoCollaboration")
```

## Abstract
Computational tools and practices are increasingly recognized as valuable and commonplace components of the general archaeological toolbox. Aside from writing one-off scripts used to process and analyze data pertaining to specific research programs, archaeologists have also been developing software designed for general use. This paper surveys the field of archaeological software development in order to understand what kinds of software archaeologists are making, and to identify norms regarding how software is built and maintained. Specifically, we focus our inquiry on collaborative aspects of software development, and how archaeologists make use of tools and platforms designed to facilitate collaboration among professional software developers. Our formal analysis of specific engagements with software development projects hosted on GitHub finds that [...]

## Materials and methods

We used *open-archaeo* <https://open-archaeo.info/>, a list of open source archaeological software and other digital resources.
The criteria for inclusion in open-archaeo are [...].
The search strategy for compiling it was [...].

```{r data-oarch}
read_csv("https://raw.githubusercontent.com/zackbatist/open-archaeo/master/open-archaeo.csv") %>% 
  mutate(category = na_if(category, "?")) %>% 
  mutate(gh_repo = str_remove(github, "https://github.com/")) ->
  oarch
```

We augmented this with data from the GitHub API for records with an associated GitHub repository.

```{r data-github}
# Warning: slow
# TODO: map
gh_langs <- map(oarch$gh_repo, gh_lang)
gh_contribs <- map(oarch$gh_repo, gh_contrib)
gh_issues <- map(oarch$gh_repo, gh_issue)
gh_comments <- map(oarch$gh_repo, gh_comment)
gh_commits <- map(oarch$gh_repo, function(x) { print(x); gh_commit(x) })
```

## Results

### Tags and categories

```{r plot-categories}
oarch %>% 
  group_by(category) %>% 
  drop_na(category) %>% 
  summarise(n = n()) %>% 
  ggplot(aes(fct_reorder(category, n), n)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Open archaeology categories",
    caption = "Data: <https://open-archaeo.info>",
    x = NULL, y = "Number of projects"
  )
```

```{r plot-tags}
oarch %>% 
  pivot_longer(c(tag1, tag2, tag3, tag4, tag5), values_to = "tag", 
               values_drop_na = TRUE) %>% 
  group_by(tag) %>%
  drop_na(tag) %>%
  summarise(n = n()) %>%
  ggplot(aes(fct_reorder(tag, n), n)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Open archaeology tags",
    caption = "Data: <https://open-archaeo.info>",
    x = NULL, y = "Number of projects"
  )
```

### Use of GitHub

```{r plot-gh_lang}
oarch$gh_lang %>% 
  pivot_longer(everything(), names_to = "language", values_to = "n") %>% 
  drop_na(n) %>% 
  group_by(language) %>% 
  summarise(n = sum(n), .groups = "drop") %>% 
  arrange(-n) %>% 
  slice(1:10) %>% 
  ggplot(aes(fct_reorder(language, n, .desc = TRUE), n)) +
  geom_col() +
  labs(title = "Languages used in GitHub repositories",
       caption = "Data: <https://open-archaeo.info> and the GitHub API",
       x = "Language", y = "Bytes of code")
```

### Repository contributors

```{r plot-gh_contributors-histogram}
oarch %>% 
  drop_na(gh_repo) %>% 
  unnest(gh_contributors) %>% 
  mutate(gh_repo = paste(gh_owner, gh_repo, sep = "/")) %>% 
  group_by(gh_repo) %>% 
  summarise(n = n(), .groups = "drop") %>% 
  ggplot(aes(x = n)) +
  geom_histogram(binwidth = 1) +
  labs(
    title = "Repositories by number of contributors",
    caption = "Data: <https://open-archaeo.info> and the GitHub API",
    x = "Contributors", y = "Repositories"
  )
```
